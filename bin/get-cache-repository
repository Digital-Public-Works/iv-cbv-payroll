#!/bin/bash
# Gets the ECR cache repository URL for the given app
# Prints the cache repository URL (e.g., 123456789.dkr.ecr.us-east-1.amazonaws.com/app)

set -euo pipefail

app_name="$1"

# Initialize terraform to pull remote state
terraform -chdir="infra/${app_name}/app-config" init > /dev/null

# Read the image repository URL from state
# Using the main repository for cache with a different tag
image_repository_url=$(terraform -chdir="infra/${app_name}/app-config" output -json build_repository_config | jq -r ".url")

echo "${image_repository_url}"
